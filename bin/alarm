#!/bin/bash
# written by Shotaro Fujimoto (https://github.com/ssh0)
#
# ```
# NAME
#       alarm - Alart after given minutes.
#
# USAGE
#       alarm n
#
#       In n, you can set n minutes.
#
# Option
#       -h: Show this help.
# ```
#==============================================================================

# set notificate icon and sound you like
notification_icon="/usr/share/icons/gnome/scalable/status/alarm-symbolic.svg"
notification_sound="/usr/share/sounds/freedesktop/stereo/alarm-clock-elapsed.oga"

# this file's path
f="$0"
# how to use this script
usage() {
  header.sh "$f" | grep -v "\`\`\`"
}

# Option hundling
while getopts h OPT; do
  case $OPT in
    "h")
      usage; exit 0 ;;
    * )
      usage; exit 1 ;;
  esac
done

# arg number check
if [ $# -ne 1 ]; then
  echo "Only 1 argument is needed: (given $#)."
  usage; exit 1
fi

# if numerical number is not set
echo $1 | egrep -q '^[0-9]+$' || (echo "Set numerical number."; exit 1)

# record start time
start_time="`date +"%Y/%m/%d %H:%M:%S"`"
echo "Start at $start_time"

# show end time
end_time=$(date -d "${start_time} $1 minutes" +"%Y/%m/%d %H:%M:%S")
echo "Alert at ${end_time} ("$1" minutes)."

# sleep n minutes ...
sleep ${1}m

# then, send notification
notify-send "Time!" "$1 min"\
  -t 6000 \
  -i "${notification_icon}"
paplay "${notification_sound}" &

exit 0

