#!/bin/sh
# written by Shotaro Fujimoto (https://github.com/ssh0)
# first edited: 2015-11-03

# using latexmk rc file
latexmkrc="$HOME/.latexmkrc_dvipng"

# texmath template
texmath_template="$HOME/.vim/template/template.texmath"

# default outputdir is setted to $imgdir
imgdir='img'

if [ "$1" = "-e" ]; then
  echo "$1"
  if [ -f "$2" ]; then
    texfile="$2"
    echo "${texfile} already exists."
  else
    texfile="fig_2"
    cat "$texmath_template" > "$texfile"
  fi
  vim "$texfile"
elif [ ! -f "$1" ]; then
  echo "$1 doesn't exist."
  exit 1
elif [ -f "$1" ]; then
  texfile="$1"
  latexmk -r "$latexmkrc" "${texfile}" \
  && latexmk -c "${texfile}" \
  && dvipng -T tight -bd 1000 "${texfile%.tex}.dvi" \
  && rm *.fls || echo "somthing wrong while running texmath"
fi
