#!/bin/sh
#------------------------------------------------------------------
#  メモリ開放                                by SONY5614
#------------------------------------------------------------------
# and modified by Shotaro Fujimoto (https://github.com/ssh0)

# set line width
columns=$(tput cols)
if [ $columns -gt 70 ]; then
  columns=70
fi
line=$(printf '%*s\n' "$columns" '' | tr ' ' -)

echo "\nThis script clear cache.\n\n"

# current memory usage
echo -n "Before:\n$line"
sudo free
echo "$line"
sudo sync

# set vm.drop_caches option number
echo "\nInput number."
echo "[0] default"
echo "[1] page cache"
echo "[2] dentry, inode"
echo "[3] page cache, dentry, inode"
echo -n ">>[0-3?]>>"
read Nomber

# clear cache
case "$Nomber" in
  "0"|"1"|"2"|"3" )
    echo ""
    echo "sudo sysctl -w vm.drop_caches=$Nomber"
    sudo sysctl -w vm.drop_caches=$Nomber
    ;;
  *)
    echo "Unexpected key. Aborted."
    exit 1
    ;;
esac

# After message
echo "\nAfter:\n$line" && sudo free
echo "$line\nDone.\n"
exit 0

